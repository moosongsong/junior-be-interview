# 프로세스

:::tip 프로세스란?
프로세스(process)는 컴퓨터에서 실행되는 있는 프로그램을 말합니다.
:::

- CPU 스케줄링의 대상이 되는 Task라는 용어와 거의 같은 의미로 쓰입니다.
- 스레드는 프로세스 내 작업 흐름을 지칭합니다.
- 프로그램이 HDD/SDD 에서 메모리에 올라가면 프로레스가 되는 인스턴스화가 일어나고, 이후 운영체제의 CPU 스케줄러에 따라 CPU가 프로세스를 실행합니다.

## 프로세스와 컴파일 과정

:::tip 프로그램이란?
프로그램은 컴파일러가 컴파일 과정을 거쳐 컴퓨터가 이해할 수 잇는 기계어로 번역되어 실행될 수 있는 파일이 되는 것을 의미합니다.  
:::

- 컴파일 과정에서 말하는 프로그램은 한줄씩 읽어들여 실행하는 인터프리터 언어가 아닌 C 언어 기반의 프로그램을 의미합니다.

## 프로그램의 컴파일 과정

![image](https://user-images.githubusercontent.com/50647845/177891741-f845765f-a5bf-4d67-9966-f834402cfe03.png)

### 전처리

- 소스 코드의 주석을 제거하고 `#include` 등 헤더파일을 병합하여 매크로를 치환합니다.

### 컴파일러

- 오류 처리, 코드 최적화 작업을 하며 어셈블리어로 변환합니다.

### 어셈블러

- 어셈블리어는 목적 코드(object code)로 변환됩니다.
- 확장자는 운영체제마다 다른데 리눅스에서는 `.o` 입니다.

### 링커

- 프로그램 내에 있는 라이브러리 함수 또는 다른 파일들과 목적코드를 결합하여 실행 파일을 만듭니다.
- 확장자는 `.exe`, `out` 입니다.

## 정적 라이브러리 vs 동적 라이브러리

라이브러리는 정적 라이브러리와 동적 라이브러리를 구분됩니다.

- 정적 라이브러리
    - 프로그램 빌드 시 라이브러리가 제공하는 모든 코드를 실행파일에 넣는 방식입니다.
    - 시스템 환경 등 외부 의존도가 낮습니다.
    - 코드 중복 및 메모리 효율성이 떨어집니다.
- 동적 라이브러리
    - 프로그램 실행시 필요할 때만 DDL 이라는 함수 정보를 통해 참조하는 방식입니다.
    - 메모리 효율성이 높아지고, 코드 중복이 줄어듭니다.
    - 시스템 환경 등 외부 의존도가 높아집니다.

## 프로세스의 상태

![image](https://user-images.githubusercontent.com/50647845/177892519-33687d08-78d5-4fde-83e8-fb00212a1f4b.png)

### 생성 상태 : `Create`

- 프로세스가 새성된 상태를 의미하여 `fork()` 또는 `exec()` 함수를 사용해 생성합니다. 이때 PCB가 할당됩니다.

:::warning 추가 설명
**fork()**

- 부모 프로세스의 주소 공간을 그대로 복사하며, 새로운 자식 프로세스를 생성하는 함수입니다.
- 주소 공간만 복사할 뿐이지 부모 프로세스의 비동기 작업 등을 상속하지 않습니다.

**exec()**

- 새롭게 프로세스를 생성하는 함수입니다.
:::

### 대기 상태 : `Ready`

- 메모리 공간이 충분하면 메모리를 할당 받고 아니면 아닌 상태로 대기하고 있으며 CPU 스케줄러로부터 CPU 소유권이 넘어오기를 기다리는 상태입니다.

### 대기 중단 상태 : `Ready Suspended`

- 메모리 부족으로 일시 중단된 상태

### 실행 상태 : `Run`

- CPU 소유권과 메모리를 할당받고 인스트럭션을 수행 중인 상태를 의미합니다.
- `CPU burst` 가 일어났다고 표현합니다.

### 중단 상태 : `Blocked`

- 어떤 이벤트가 발생한 이후 기다리며 프로세스가 차단된 상태입니다.
- I/O 디바이스에 의한 인터럽트로 이런 현상이 많이 발생합니다.

### 일시 중단 상태 : `Blocked Suspended`

- 대기 중단 상태와 유사한데, 중단된 상태에서 프로세스가 실행되려고 했지만 메모리 부족으로 일시 중단된 상태입니다.

### 종료 상태 : `Terminated`

- 메모리와 CPU 소유권을 모두 놓고 가는 상태를 의미합니다.
- 종료는 자연스로운 종료도 있지만, 부모 프로세스가 자식 프로세스를 강제시키는 비자발적 종료(abort)로 종료될 수 있습니다.
- 자식 프로세스에 할당된 자원의 한계치를 넘어서거나 부모 프로세스가 종료되거나 사용자가 프로세르 킬을 위한 명령어로 종료할 때도 발생합니다.

## 프로세스의 메모리 구조

![image](https://user-images.githubusercontent.com/50647845/177894458-c54d42e5-a2c1-4571-8866-38a0794a04c8.png)

스택과 힙은 동적 영역, 데이터 영역과 코드 영역은 정적 영역입니다.

### 스택

- 스택에는 지역변수, 매개변수, 함수가 저장되고 컴파일 시에 크기가 결정되며 동적인 특징을 갖습니다.
- 함수가 재귀적으로 호출되면서 동적으로 크기가 들어날 수 있는데, 이때 힙과 스택의 메모리 영역이 겹치면 안 되기에 힙과 스택 사이의 공간이 존재합니다.

### 힙

- 동적 할당 시에 사용되며 런타임 시 크기가 결정됩니다.

### 데이터 영역

- 전역 변수, 정적 변수가 저장되고, 정적인 특징을 갖는 프로그램이 종료되면 사라지는 변수가 들어있는 영역입니다.
- 데이터 영역은 BSS 영역과 Data 영역으로 나뉘고, BSS 영역은 초기화 되지 않은 변수가 0으로 초기화 되어 저장되며, Data 영역은 0이 아닌 다른 값으로 할당된 변수들이 저장됩니다.

### 코드 영역

- 프로그램에 내장되어 있는 소스 코드가 적재되며, 수정 불가능한 기계어로 저장됩니다.

### 참고자료

- [면접을 위한 CS 전공지식 노트:도서](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=292815727)
- [gracefulprograming:tistory](https://gracefulprograming.tistory.com/16)
- [enlqn1010:tistory](https://enlqn1010.tistory.com/30)
- [blog.yevgnenll.me](https://blog.yevgnenll.me/os/process-concepts-process-state-and-managed-in-memory)
